---
title: "MSF_Groupwork-NBA_shotlog" 
author: "Team_9"
output:
  pdf_document: default
  html_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
Report produced by: Justin Leiendecker, Alexander Romanenko, Artmeis Tomadaki-Balomenou, Zijun Wei, Reza Brianca Widodo  
Date submitted: 16/10/2016

#Report structure 

##Introduction
###What is your theme or research question?
    a. Hot Hand Theory (Artemis)
    b. Defender Proximity Analysis (Reza)
    c. Shot Clock Pressure  (Alex)
    d. Close Game Effect - Small Margin affecting the scoring rate 
    e. Home Advantage (Alex is working in this point)  
    f. Fatigue Effect (Quarter Heat Rate)  
    g. Shooting Percentage (James)
    h. Fatigue Effect (Number of Rest Day)  
    i. Regression Analysis (Alex)

###Introduction/Summary

The purpose of this report is to analyse a chosen dataset and to produce meaningful results using statistical and mathematical analysis. These analyses have been conducted using RStudio software. This report will focused on analysis of a number of areas, demonstrate how the analysis has been conducted, discusses theory used, demonstrate and evaluate produced results. In addition this report will highlight potential areas of future research. 

The chosen dataset for this report is a summary of shots made during NBA season 2015-2016. The following areas of research have been selected:

#Report structure 

##Introduction
I   What is your theme or research question?
a. Hot Hand Theory (Artemis)
b. Defender Proximity Analysis (Reza)
c. Shot Clock Pressure  (Alex)
d. Close Game Effect - Small Margin affecting the scoring rate 
e. Home Advantage (Alex is working in this point)  
f. Fatigue Effect (Quarter Heat Rate)  
g. Shooting Percentage (James)
h. Fatigue Effect (Number of Rest Day)  
i. Regression Analysis (Alex)

##Theory
I   What do you expect to find?
a. 

##Methods
###Dataset Description:  
  
  Data on shots taken during the NBA 2014-2015 season for regular matches throughout the year. The data comprise of 128,609 rows and 22 columns with 16 MB data size with several value in some column is missing. The column titles are generally self-explanatory. It has the following data:   
    1.  Match ID  
    2.  Match date  
    3.  Which team plays as home and away  
    4.  Match result  
    5.  Final score difference  
    6.  Every shots attempt per game for each player  
    7.  Shot result whether it is success or not  
    8.  Type of shoot attempt (2 points or 3 points)  
    9.  Quarter number data (1 to 4)  
    10. Game clock for each quarter  
    11. Time left for a shot (shot clock)  
    12. Who took the shot  
    13. Shot distance from basket  
    14. Who was the nearest defender  
    15. Distance from the nearest defender  
  
  The dataset is useful for evaluating who the best shooter is, who the best defender is, the hot-hand hypothesis, affect of home playing team, close game effect, shooting accuracy from best players, and defender distance effect on shooting accuracy. Data was taken from NBA's REST API provided by [Kaggle](https://www.kaggle.com/dansbecker/nba-shot-logs) and acquired at 30 September 2016.  

###Dataset Strengths  
    
    The dataset comprise of comprehensive observational data to start to work with. In general, the dataset only have small percentage of missing value (0.19%) so we do not need to remove or assign many data points to default values. And since the column name is not ambiguous it really helps us to understand dataset from the beginning. 

###Dataset Limitations  
  There are several constraints we need to mentioned in order to provide same understandings for this group work analysis as follows:  
    1. The dataset consists only for 1 year NBA season (2014-2015)  
    2. The dataset comprise only with regular match (82 matches per team for both home and away matches)  
    3. The playoff and other matches during the year is not included
    4. The dataset does not include free throw shot and results

##Analysis

### Installing libraries

```{r}
install.packages('reshape')
#install.packages('gridExtra')
```


### Calling libraries
```{r}
library(reshape)
library(ggplot2)
library(gridExtra)
```


###Data clean-up 

```{r}
df<- read.csv("shot_logs.csv")  #assigning the dataframe to 'df' variables
attach(df) #telling R that this is the dataframe we'll be working with (eliminating the need to use df$ for variables)

df1<- read.csv("shot_logs1010.csv")

# replacing W/L in column "W" with 1/0 (1 for win, 0 for loss)
df[,"W"] <- as.character(df[,"W"])

for (i in 1:nrow(df)) {
  if (df[i,"W"]=="W") df[i,"W"]<- 1
  if (df[i,"W"]=="L") df[i,"W"]<- 0}

df[,"W"] <- as.numeric(df[,"W"])
```

```{r}
#adding columns for names of 'home' and 'away' teams. In addition, WINNER column tells which team won
df[,"MATCHUP"] <- as.character(df[,"MATCHUP"])
df[,"W"] <- as.character(df[,"W"])

for (i in 1:nrow(df)) {
  if (LOCATION[i] == "H") {df$HOME_TEAM [i] <- unlist(strsplit(df$MATCHUP[i]," "))[5]
  df$AWAY_TEAM [i] <- unlist(strsplit(df$MATCHUP[i]," "))[7]
  if (W[i]=="W") df$WINNER[i] <- "HOME" 
  if (W[i]=="L") df$WINNER[i] <- "AWAY"}
  if (LOCATION[i]=="A") {df$HOME_TEAM [i] <- unlist(strsplit(df$MATCHUP[i]," "))[7] 
  df$AWAY_TEAM [i] <- unlist(strsplit(df$MATCHUP[i]," "))[5]
  if (W[i]=="L") df$WINNER[i] <- "HOME"  
  if (W[i]=="W") df$WINNER[i] <- "AWAY"}}

#adding a column 'DATE'
df1[,"MATCHUP"] <- as.character(df1[,"MATCHUP"])
for (i in 1:nrow(df1)) df1$DATE[i] <- as.character(as.Date(unlist(strsplit(df1$MATCHUP[i]," -"))[1], format= "%B %d, %Y"))

restdays <- cast(df1, DATE + HOME_TEAM + AWAY_TEAM + WINNER ~ FGM, value = 'FGM')

#this code is supposed to produce a list of dates when teams play at HOME in DATES column. for some reason it is not working.

for (i in aa3$TEAM) {
  for (j in 1:nrow(restdays)) {
    aa3$DATES<- as.list(aa3$DATES)
    if (restdays$HOME_TEAM[j]==i) aa3$DATES[aa3$TEAM==i]<- c(aa3$DATES[aa3$TEAM==i], restdays$DATE[j])}}


```

## Home Advantage analysis
###Introduction

This area of analysis focuses on investigation of whether playing at 'home' gives the team advantage comparing to playing 'away'. 

Literature review demonstrates that 

The NULL Hypothesis is: 


```{r}
aa<- cast(df1, GAME_ID1 + HOME_TEAM + AWAY_TEAM + WINNER ~ W)

table(aa$WINNER)
#home wins:
hh<-sum(aa$WINNER=="HOME")
#Away wins:
aw<-sum(aa$WINNER=="AWAY")
#percentage of home team winning: 
round(hh/(hh+aw),2)
round(aw/(hh+aw),2)

```

```{r}
head(aa)
aa1<- cast(aa, HOME_TEAM  ~ WINNER); names(aa1)[1]<-"TEAM"
aa1$WIN_PCT_HOME<-round(aa1$HOME/(aa1$HOME+aa1$AWAY),2)

aa2<- cast(aa, AWAY_TEAM ~ WINNER); names(aa2)[1]<-"TEAM"
aa2$WIN_PCT_AWAY<-round(aa2$AWAY/(aa2$HOME+aa2$AWAY),2)

aa3<- merge (aa1,aa2, by ="TEAM")


for (i in 1:nrow(aa3)) {if(aa3$WIN_PCT_HOME[i]>aa3$WIN_PCT_AWAY[i]) aa3$HOME_ADV[i]<-"YES" else aa3$HOME_ADV[i]<-"NO"}
head(aa3)

aa3<- aa3[order(aa3$WIN_PCT_HOME,decreasing=TRUE),]
rownames(aa4)<-NULL

aa3$TEAM <- factor(aa3$TEAM, levels = aa3$TEAM[order(-aa3$WIN_PCT_HOME)])


ggplot(aa3,aes(x=TEAM)) + geom_point(aes(y= WIN_PCT_HOME, col= "HOME"))+ geom_point(aes( y= WIN_PCT_AWAY, col= "AWAY")) 
 
```

##Close Game Effect (Justin)


The potential effects of tiredness and stress on the accuracy of shots are investigated in this part of the analysis. 




```{r}
# create new variable to seperate overtime

df[, "overtime"] <- as.numeric()

for (i in 1:nrow(df)) {
  if (df[i, "PERIOD"] >= 5) df[i, "overtime"] <- 1
  if (df[i, "PERIOD"] <= 4) df[i, "overtime"] <- 0
}

# accuracy per period

df.acc <- data.frame()
  
for (i in (1:7)){
  df.acc[i, "accuracy"] <- sum(df$PERIOD == i & df$FGM == 1)/sum(df$PERIOD == i)
  df.acc[i, "period"] <- i
  if (df.acc$period[i] <= 4) df.acc[i, "overtime"] <- 0
  if (df.acc$period[i] >= 5) df.acc[i, "overtime"] <- 1
}


t.test(df$FGM[df$PERIOD == 1], df$FGM[df$PERIOD == 2])
t.test(df$FGM[df$PERIOD == 2], df$FGM[df$PERIOD == 3])
t.test(df$FGM[df$PERIOD == 3], df$FGM[df$PERIOD == 4])
t.test(df$FGM[df$PERIOD == 1], df$FGM[df$PERIOD == 3])
t.test(df$FGM[df$PERIOD == 2], df$FGM[df$PERIOD == 4])


# accuracy per player per period

df.period <- cast(df, player_id + player_name + PERIOD ~ FGM)

df.period[, "accuracy"] <- as.numeric()

for (i in 1:nrow(df.period)){
  df.period[i, "accuracy"] <- df.period[i, "1"] / sum(df.period[i, "1"], df.period[i, "0"] ) }
  
# do analysis for top players per team in regards of accuracy per period

# accuracy for Shot Clock

# dealing with missing values
df[is.na(df)] <- 99

acc <- data.frame(seconds.left = c(0:23))

#accuracy for every second
for (i in (0:23)){
  acc[i, "accuracy"] <- (sum(df$SHOT_CLOCK >= i & df$SHOT_CLOCK < i+1 & df$SHOT_CLOCK != 99 & df$FGM == 1)/sum(df$SHOT_CLOCK >= i & df$SHOT_CLOCK < i+1 & df$SHOT_CLOCK != 99))}

ggplot(acc, aes(x = seconds.left, y = accuracy)) + geom_point() + geom_smooth()



#accuracy for players per second

##simplifying shot clock to seconds left
  
df.acc.players <- cast(df, player_id + player_name + SHOT_CLOCK ~ FGM)

for (i in (1:nrow(df.acc.players))){
  for (j in (0:23)){
    if (df.acc.players$SHOT_CLOCK[i] >= j & df.acc.players$SHOT_CLOCK[i] < j+1) df.acc.players[i, "seconds.left"] <- j
    if (df.acc.players$SHOT_CLOCK[i] == 99) df.acc.players[i, "seconds.left"] <- 99}
}

df.acc.players[, "acc.per.sec"] <- as.numeric()

### doesnt work as I would like it:

for (i in (1:nrow(df.acc.players))){
  for (j in (0:23)){
    df.acc.players[i, "acc.per.sec"] <- sum(df.acc.players$'1'[df.acc.players$seconds.left == j])}
}
  

ggplot(df.acc.players, aes(x = seconds.left, y = ))

#Assign accuracy per second to main dataframe
df[, "acc.per.sec"] <- as.numeric()

for (i in 1:nrow(df)){
  for (j in 0:23){
    if (df$SHOT_CLOCK[i] >j & df$SHOT_CLOCK[i] <= j+1 & df$SHOT_CLOCK[i] != 99) df[i, "acc.per.sec"] <- acc[j, "accuracy"]
  }
}


```




## Shooting Percentage Analysis (James)

```{r}
# Replace "made" and "missed" with 1 and 0 respectively

df[, "SHOT_RESULT"] <- as.character(df[, "SHOT_RESULT"])
 
for (i in 1:nrow(df)) {
  if (df[i, "SHOT_RESULT"] == "made") df[i, "SHOT_RESULT"] <- 1
  if (df[i, "SHOT_RESULT"] == "missed") df[i, "SHOT_RESULT"] <- 0
}

df[, "SHOT_RESULT"] <- as.numeric(df[, "SHOT_RESULT"])

```

### Find shooting percentage of each match
### Find field goal percentage (FG percentage) for each match


```{r}
# Reshape the dataframe

shot.stats <- cast(data = df, GAME_ID1 + HOME_TEAM + AWAY_TEAM + LOCATION  + W + player_name + FINAL_MARGIN ~ FGM)

# Field Goal Attempts

shot.stats[, "FGA"] <- NA
for(i in 1:nrow(shot.stats)){
  shot.stats[i, "FGA"] <- shot.stats[i, "1"] + shot.stats[i, "0"]
}

# Find Feild Goal Percentage of each indivudual player in that match

shot.stats[, "FG.percentage"] <- NA 
for (i in 1:nrow(shot.stats)){
  shot.stats[i, "FG.percentage"] <- round(((shot.stats[i, "1"]/shot.stats[i, "FGA"]) * 100), digits = 2)
}
```

<<<<<<< HEAD
### Impact of Super Star Players
### Impact of Top Scorers


```{r}
# Pick out 8 of the best players in that regular season and create a new subset. Analyse how shooting percentage of these players can influence the result of a match.

top.scorers.list <- c("paul millsap", "isaiah thomas", "brook lopez", "kemba walker", "jimmy butler", "mnta ellis", "ty lawson", "reggie jackson", "lebron james", "james harden", "russell westbrook", "stephen curry", "anthony davis", "blake griffin", "lamarcus aldridge", "cj miles", "kobe bryant", "marc gasol", "dwayne wade", "brandon knight", "andrew wiggins", "carmelo anthony", "nikola vucevic", "michael carter-williams", "eric bledsoe", "demarcus cousins", "kawhi leonard", "kyle lowry", "gordon hayward", "john wall") # players picked out
top.scorers <- shot.stats[shot.stats$player_name %in% top.scorers.list, c("player_name", "W", "LOCATION", "FINAL_MARGIN", "FGA", "FG.percentage")] # create a subset for these players

# Replace "W" and "L" with 1 and 0 respectively, 
top.scorers[, "W"] <- as.character(top.scorers[, "W"])
for (i in 1:nrow(top.scorers)) {
  if (top.scorers[i, "W"] == "W") top.scorers[i, "W"] <- 1
  if (top.scorers[i, "W"] == "L") top.scorers[i, "W"] <- 0
}
top.scorers[, "W"] <- as.numeric(top.scorers[, "W"])

ggplot(top.scorers) + geom_boxplot(aes(x = player_name, y = FGA, colour = W))
ggplot(top.scorers) + geom_boxplot(aes(x = player_name, y = FG.percentage, colour = W))
ggplot(top.scorers) + geom_point(aes(x = FINAL_MARGIN, y = FGA, colour = player_name))
ggplot(top.scorers) + geom_boxplot(aes(x = LOCATION, y = FINAL_MARGIN))

# t.test(top.scorers$FINAL_MARGIN[top.scorers$LOCATION == "H"], top.scorers$FINAL_MARGIN[top.scorers$LOCATION == "A"])

# Correlation test
cor.test(top.scorers$FINAL_MARGIN, top.scorers$FGA)
cor.test(top.scorers$FINAL_MARGIN, top.scorers$FG.percentage) # cor = 0.272

# Linear regression
summary(lm(FINAL_MARGIN ~ FGA + LOCATION, data = top.scorers)) # Final margin ~ FGA and location
summary(lm(FINAL_MARGIN ~ FG.percentage + LOCATION, data = top.scorers)) # Final margin ~ FG% and location
summary(lm(FINAL_MARGIN ~ FG.percentage + FGA + LOCATION, data= top.scorers)) 

summary(lm(FINAL_MARGIN ~ LOCATION, data = top.scorers)) # Final margin ~ FGA and location

```


##Defender Proximity Analysis  
###Closest Defender Distance vs Shot Accuracy
####Introduction  
This analysis would calculate whether there was any significant effect from closest defender distance from a shooter with the shot outcome. The hypothesis is the further a defender from the shooter, then it will be more likely to increase the chance of scoring. This is because the shooter is practically in "free" condition without any physical interference.  

###Methods  
The steps to calculate this measurement are as follows:  
  1. Assign shot result to determine whether the shot is succeed (1) or missed (0)  
  2. Select distinct of **all** closest defender distance  
  3. Count the occurence fOr every distance  
  4. Calculate how many succesfull shot scored from every distance point  
  5. Calculate accuracy by dividing successfull shot scored with distance occurence for every defender distance point  
  6. Plot the result
```{r}
#Calculate accuracy against defender distance
#Group the defender distance level
distance_level <- as.data.frame(table(factor(ClosestDefenderDistance)))
head(distance_level)

#Calculate how many times players scored in every defender distance
for (i in 1:nrow(distance_level)){
  distance_level[i, "SCORED"] <- sum(df[df[, "CLOSE_DEF_DIST"] == distance_level[i, "Var1"], "FGM"])
}

#Calculate shooting accuracy for each distance
distance_level$Accuracy <- round(distance_level$SCORED / distance_level$Freq, 4)

#Plotting the result
library(ggplot2)
library(scales)
ggplot(data = distance_level, aes(x = distance_level$Var1, y = distance_level$Accuracy)) +
  geom_point(aes(x = distance_level$Var1, y = distance_level$Accuracy)) +
  scale_y_continuous(labels = percent, breaks = c(0, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 1.0), limits = c(0, 1)) +
  scale_x_discrete("Closest Defender Distance", breaks = c(0, 2, 4, 6, 8, 10, 12, 14, 16, 18, 20, 22, 24)) +
  geom_smooth() +
  ylab("Shooting Accuracy (%)") +
  ggtitle("Closest Defender Distance vs Shooting Accuracy")

```
###Plot Result
  The explanation from the plot above are as follows:   
  1. If the defender stands really close to the shooter (0 to 2 feet), the accuracy varied between **42%** to **50%**  
  2. If the defender distance range from 2 to 4 feet, the accuracy rate for this distance range from **44%** to **49%**  
  3. If the defender distance range from 4 to 6 feet, the accuracy rate for this distance range from **41%** to **46%**
  4. If the defender distance range from 6 to 8 feet, the accuracy rate for this distance range from **37%** to **42%**
  5. If the defender distance range from 8 to 10 feet, the accuracy rate for this distance range from **37%** to **54%**
  6. For defender distance more than 10 feet up until 16 feet, the accuracy varies greater than previous distance range, starting from **33%** to **60%**.  
  7. For the distance greater than 16 feet, the data varies between **0%** (no shots scored from that distance) to **100%** (certain successfull shot from that distance)  

  Next analysis will be calculated from correlation test. If the analysis included **all** of the data points for every distance, the correlation result would be as follows:
```{r}
#change distance level to numeric type for correlation test function
distance_level$Var1 <- as.numeric(distance_level$Var1)
distance_level$Var1 <- distance_level$Var1 * 0.1 - 0.1 #to keep the distance point as it is

#populate data points from data frame
distanceZerotoAll <- c()
accuracyDist1 <- c()
for (i in 0:nrow(distance_level)){
  distanceZerotoAll <- c(distanceZerotoAll, distance_level[i, "Var1"])
  accuracyDist1 <- c(accuracyDist1, distance_level[i, "Accuracy"])
}

#combine data frame
dfZerotoAll <- data.frame(distanceZerotoAll, accuracyDist1)

#calculate correlation
cor.test(dfZerotoFive$distanceZerotoAll, dfZerotoFive$accuracyDist1)
```
###Correlation Test Result  
  The correlation test result produced slightly high number of correlation between defender distance with shooting accuracy for all shot distance attempt in the last seasons's NBA (0.59). If the findings made only based on this number only, there would be obvious that further defender distance will **automatically** increase shooting accuracy. However, after the analysis went into smaller piece of distance, ther result will be difference. For example, for distance range between 0 (zero) to 8 feet, the correlation measurement will be as follows:  
  
```{r}
#populate data from data frame
distanceZerotoEight <- c()
accuracyDist2 <- c()
for (i in 0:80){
  distanceZerotoEight <- c(distanceZerotoEight, distance_level[i, "Var1"])
  accuracyDist2 <- c(accuracyDist2, distance_level[i, "Accuracy"])
}

#combine data frame
dfZerotoEight <- data.frame(distanceZerotoEight, accuracyDist2)

#calculate correlation
cor.test(dfZerotoEight$distanceZerotoEight, dfZerotoEight$accuracyDist2)
```
  As the analysis shown, the correlation measurement between 0 (zero) to 8 feet would be negative (-0.40). This result was different with the previous calculation done for all data points (0.59).
  
###Discussion  
  As the analysis shown, the accuracy rate of every player in the last season was somehow **affected** by the defender distance for certain range. For defender distance starting from 0 (zero) to 8 (eight) feet For the distance greater than 16 feet, the data varies between 0% (no shots scored from that distance) to 100% (certain successfull shot from that distance). It is also shown from the dataset that only small attempt of shots were made from further defender distance affecting the accuracy calculation result. However, from the correlation perspective, the result would be different if the analysis included all of the data points versus only included short distance data points. This was arguably because further defender distance did not implied shooter distance from the basket is nearer to improve the accuracy and also there were not many players to perform shooting attempt automatically although their opponent was standing far from the shooter

###Limitations  
  As the dataset did not hold many data points for more than 20 feet defender distance, the accuracy analysis for these distances are limited. The analysis could be enhanced further by including additional season data. That way, there will be more data point for further distance and possibly would produce stronger pattern as the short distance shown.  
  
###Shooting Distance vs Shot Accuracy
####Introduction  
This analysis would calculate whether was there any significant effect from shooting distance from basket with the shot outcome. The hypothesis is the further a shooter from the basket, then the success rate would be decreased. This was because when the shooter was practically in closer shooting range, the shooter shooting's result would be more accurate.  

###Methods  
The steps to calculate this measurement are as follows:  
  1. Assign shot result to determine whether the shot is succeed (1) or missed (0)  
  2. Select distinct of **all** shooting distance  
  3. Count the occurence fOr every distance  
  4. Calculate how many succesfull shot scored from every distance point  
  5. Calculate accuracy by dividing successfull shot scored with particular distance occurence for every shooting distance point  
  6. Plot the result
```{r}
#Calculate accuracy against shooting distance
#Group the shooting distance level
shooting_distance_level <- as.data.frame(table(factor(ShotDistance)))
head(shooting_distance_level)

#Calculate how many times players scored in every shooting distance
for (i in 1:nrow(shooting_distance_level)){
  shooting_distance_level[i, "SCORED"] <- sum(df[df[, "SHOT_DIST"] == shooting_distance_level[i, "Var1"], "FGM"])
}

#Calculate shooting accuracy for each distance
shooting_distance_level$Accuracy <- round(shooting_distance_level$SCORED / shooting_distance_level$Freq, 4)

#Plotting the result
library(ggplot2)
library(scales)
ggplot(data = shooting_distance_level, aes(x = shooting_distance_level$Var1, y = shooting_distance_level$Accuracy)) +
  geom_point(aes(x = shooting_distance_level$Var1, y = shooting_distance_level$Accuracy)) +
  scale_y_continuous(labels = percent, breaks = c(0, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 1.0), limits = c(0, 1)) +
  scale_x_discrete("Shooting Distance", breaks = c(0, 2, 4, 6, 8, 10, 12, 14, 16, 18, 20, 22, 24, 26, 28, 30, 32, 34, 36, 38, 40, 42, 44, 46, 48)) +
  geom_smooth() +
  ylab("Shooting Accuracy (%)") +
  ggtitle("Shooting Distance vs Shooting Accuracy")

```

###Plot Result
  The explanation from the plot above are as follows:   
  1.  If the shooter stands really close to the basket (0 to 2 feet), the accuracy varied between **62%** to **68%**  
  2.  If the shooting distance range from 2 to 4 feet, the accuracy rate for this distance range from **61%** to **67%**  
  3.  If the shooting distance range from 4 to 6 feet, the accuracy rate for this distance range from **44%** to **58%**  
  4.  If the shooting distance range from 6 to 8 feet, the accuracy rate for this distance range from **38%** to **51%**  
  5.  If the shooting distance range from 8 to 10 feet, the accuracy rate for this distance range from **35%** to **42%**  
  6.  If the shooting distance range from 10 to 12 feet, the accuracy rate for this distance range from **34%** to **42%**  
  7.  If the shooting distance range from 12 to 14 feet, the accuracy rate for this distance range from **37%** to **47%**  
  8.  If the shooting distance range from 14 to 16 feet, the accuracy rate for this distance range from **33%** to **51%**  
  9.  If the shooting distance range from 16 to 18 feet, the accuracy rate for this distance range from **37%** to **48%**  
  10. If the shooting distance range from 18 to 24 feet, the accuracy rate for this distance range from **33%** to **43%**  
  11. If the shooting distance range from 24 to 28 feet, the accuracy rate for this distance range from **18%** to **38%**  
  12. For shooting distance more than 28 feet, the accuracy varies greater than previous distance range, starting from **0%** (no shots scored from that distance) to **50%**  

  Next analysis will be calculated from correlation test. If the analysis included **all** of the data points for every distance, the correlation result would be as follows:  
```{r}
#change distance level to numeric type for correlation test function
shooting_distance_level$Var1 <- as.numeric(shooting_distance_level$Var1)
shooting_distance_level$Var1 <- shooting_distance_level$Var1 * 0.1 - 0.1 #to maintain distance data point as it is

#populate data for every shooting distance
shootingDistanceZerotoAll <- c()
shootingAccuracyDist1 <- c()
for (i in 0:nrow(shooting_distance_level)){
  shootingDistanceZerotoAll <- c(shootingDistanceZerotoAll, shooting_distance_level[i, "Var1"])
  shootingAccuracyDist1 <- c(shootingAccuracyDist1, shooting_distance_level[i, "Accuracy"])
}

dfShootingZerotoAll <- data.frame(shootingDistanceZerotoAll, shootingAccuracyDist1)
cor.test(dfShootingZerotoAll$shootingDistanceZerotoAll, dfShootingZerotoAll$shootingAccuracyDist1)
```
###Correlation Test Result  
  The correlation test result shown strong negative correlation between shooting distance and shooting accuracy (-0.87). This meant that for all data points, the further a shooter from the basket, it was unlikely the shooter's attempt was success, regardless who was the shooter. However, if the correlation test taken for certain range distance based on the diagram, for example range from 10 feet to 20 feet, the correlation result would be different as follows:

```{r}
#populate data for shooting distance in range 10 to 24 feet
shootingDistance10to20 <- c()
shootingAccuracyDist2 <- c()
for (i in 100:200){
  shootingDistance10to20 <- c(shootingDistance10to20, shooting_distance_level[i, "Var1"])
  shootingAccuracyDist2 <- c(shootingAccuracyDist2, shooting_distance_level[i, "Accuracy"])
}

dfShooting10to20 <- data.frame(shootingDistance10to20, shootingAccuracyDist2)
cor.test(dfShooting10to20$shootingDistance10to20, dfShooting10to20$shootingAccuracyDist2)
```
  The second correlation test produced a small positive correlation between range 10 to 20 feet (0.11). This result was different with previous measurement (-0.87)  
  
###Discussion  
  Based on the diagram and correlation, it can be concluded that although the shooting distance would directly affect shooting accuracy, but the relationship between these variables are not perfectly linear. This was shown in the diagram where there was a relatively **similar** shooting accuracy for shots taken from 10 feet until 20 feet, regardless the shooter's performance. And for the success rate in longer distances, it could be arguably inferred as the shooters tried to attempt in closing game time (buzzer beater) when the shot clock or game clock nearly reach zero.    

###Limitations  
 Since the dataset mostly return 0% for shooting distance greater than 30 feet, it would better if the dataset could be enriched with previous season statistics, or even the last 10 seasons to exercise in more detail about the pattern for long distance shots attempt.  
```{r}
#Summary of total points
ptssum<- cast(df1, GAME_ID1+ player_id + player_name  ~ PTS); head(ptssum)
#creating "total points per player, per game" column
ptssum$totalpts<- ptssum[,"2"]*2 + ptssum[,"3"]*3

pttsum2<-ptssum[order(ptssum$totalpts,decreasing=TRUE),]
head(pttsum2,10)
```

##Hot Hand Theory
###Introduction
  The analysis aims to show the effect of the 'hot hand theory' on NBA players. The analysis is based on the hypothesis that a shooter with a hot hand will have shots that are not independent of one another. If the shooter makes his first shot, the probability of making his next shot is higher.

###Methods
The steps to approximate this question are as follows:
  1. Calculate streaks achieved in all games and from all players
  2. Categorize streaks per player and game, focusing on the 3 players with the top 3 performances in terms of points
  3. Extract zeros and keep only streaks above 1
  4. Visualise streaks' length distribution - barrplots
  5. Visualise streaks' length via boxplot
  6. Calculate the shooting percentage of the 3 players 
  7. Create a sample independent shooter setting as shooting percentage the real player's shooting percentage
  8. Compare distributions of sample and real player 

```{r}

#From 'FGM' column we have that 1 represents a basket made and 0 represents a basket missed
#Define the length of a shooting streak to be the number of consecutive baskets made until a miss occurs
#Create a function that gives us a vector with the number of total streaks(from all players and all games)
number_of_streaks <- function(x) {
  x <- c(0, x, 0)
  which_zero <- which(x == 0)
  streak <- diff(which_zero) - 1
  streak
}

number_of_streaks(df$FGM)

#Set a new data frame for the 3 players with best performances(higher points)
best_players_df <- head(pttsum2,3)

#Create a function that gives us a vector of streaks for a specific player and game
player_and_game <- function(x, y) {
   player <- df[df[ ,'player_id'] == x & df[ ,'GAME_ID1'] == y, 'FGM']
   number_of_streaks(as.vector(player))
}
#For the first player and game try:
#player_and_game('202681', '21400681')


#Create a list that gives us the streaks of each player and game (5 best performances)
streak_per_player <- list()
j <- 1
for(i in best_players_df$player_id) {
   streak_per_player[[j]] <- player_and_game(i, best_players_df[ourtable[ ,'player_id'] == i, 'GAME_ID1'])
   j <- j + 1
}
streak_per_player

#Remove 0 from streak_per_player in order to show only the streaks achieved
streak_per_player[[1]] <- streak_per_player[[1]][streak_per_player[[1]] != 0]
for(i in 1:length(streak_per_player)) {
  streak_per_player[[i]] <- streak_per_player[[i]][streak_per_player[[i]] != 0]
}
streak_per_player
```

###Barplots
```{r}

#Create a data frame for the strikes of each one of the 3 players (cannot create a data frame including all of them, because each list has different length)
player1_df <- data.frame('streaks' = streak_per_player[[1]])
player2_df <- data.frame('streaks' = streak_per_player[[2]])
player3_df <- data.frame('streaks' = streak_per_player[[3]])
best_players_df
#Show distribution for each player's streak lengths
gg1 <- ggplot(data = player1_df, aes(x = streaks)) + geom_bar(fill = 'brown') + labs(title = 'Kyrie Irnving')
gg2 <- ggplot(data = player2_df, aes(x = streaks)) + geom_bar(fill = 'red') + labs(title = 'Mo Williams')
gg3 <- ggplot(data = player3_df, aes(x = streaks)) + geom_bar(fill = 'blue') + labs(title = 'Klay Thompson')
grid.arrange(gg1, gg2, gg3, ncol = 3)
```

  The distribution of the three players is unimodal and left skewed. There are shown some extremely long shooting streaks made(i.e. Klay Thompson with 13 shots in a row).  

###Boxplots
####Boxplot for Kyrie Irnving
```{r}
#Create a boxplot for each player's streak lengths 
boxplot(player1_df$streaks) 
summary(player1_df$streaks) #Check that boxplot is valid
IQR(player1_df$streaks) #Check that boxplot is valid
```

  1. The typical length of a streak is 1 (median = 1)
  2. The Interquartile Range is 1 
  3. Streak length of 6 is unusually high compared to the rest of the distribution

####Boxplot for Mo Williams
```{r}
boxplot(player2_df$streaks)
summary(player2_df$streaks)
IQR(player2_df$streaks)
```

  1. The typical length of a streak is 1.5 (median = 1.5)
  2. The Interquartile Range is 1
  3. Streak length of 4 is unusually high compared to the rest of the distribution

####Boxplot for Klay Thompson
```{r}
boxplot(player3_df$streaks)
summary(player3_df$streaks)
IQR(player3_df$streaks)
```

  1. The typical length of a streak is 8 (median = 8)
  2. The Interquartile Range is 5
  3. Streak length of 13 is unsually high compared to the rest of the distribution

### Plots Result

  The distribution of all players is left skewed and all of them (especially player3) have some long shooting streaks. In order to prove/disprove the hot hand theory,  the examination of the indipendence of the shots is required. If each shot that a player takes is independent of the next shot, then the player has the same probability of hitting each shot regardless of the previous shot. If each shot that a player takes is dependent of the next shot, then the probability of making the next shot is higher - hot hand. Sampling an independent shooter having the same shooting percentage with the real one and comparing his distribution with real player's distribution gives further insight in the specific aera. 

```{r}
#Find the shooting percentage for each of the 3 players
j <- 1
shooting_percentage <- list()
for(i in best_players_df$player_id) {
  shooting_percentage[j] <- sum(df[df[ ,'player_id'] == i, 'FGM'])/ nrow(df[df[ ,'player_id'] == i, ])
  j <- j+1
}
shooting_percentage
```

###Kyrie Irving
```{r}
###PLAYER 1 VS SAMPLE PLAYER###
#Simulation - create a vector of shots('made', 'missed') for a sample shooter, setting as probability the shooting percentage of the real shooter1 
set.seed(974)
shot_results <- c('made', 'missed')
simul_shooter <- sample(shot_results, size = length(streak_per_player[[1]]), replace = TRUE, prob = c(shooting_percentage[[1]], 1 - shooting_percentage[[1]]))
simul_shooter


#Set 1 for baskets made and 0 for baskets missed
simul_shooter <- as.list(simul_shooter)
for(i in 1:length(simul_shooter)) {
   if(simul_shooter[i] == 'made') simul_shooter[i] <- 1
   else if(simul_shooter[i] == 'missed') simul_shooter[i] <- 0
}
simul_shooter

#Use previous function (number_of_streaks) to calculate the streaks made by the sample shooter 
streaks_of_simulshooter <- number_of_streaks(simul_shooter)

#Create new data frames for the graphs 
simulshooter_df <- data.frame('streaks' = streaks_of_simulshooter)
realshooter_df <- data.frame('streaks' = streak_per_player[[1]])

#Comparisons of data between sample shooter and real shooters
summary(simulshooter_df$streaks)
summary(realshooter_df$streaks)

#Compare barplots of sample shooter and real shooter1
#If real shooter's streaks diverge significantly from an independent shooter's streaks(sample shooter's streaks), we can conclude tha the real shooter has a 'hot hand'. 
g1 <- ggplot(data = simulshooter_df, aes(x = streaks )) + geom_bar() + labs(title = 'sample shooter')
g2 <- ggplot(data = realshooter_df, aes(x = streaks)) + geom_bar() + labs(title = 'Kyrie Irving')
grid.arrange(g1, g2, ncol = 2
```

  The streak length distributions are quite similar, so we can conclude that Kyrie Irving doesn't have a hot hand.

### Mo Williams
```{r}
###PLAYER 2 VS SAMPLE PLAYER###
#Simulation - create a vector of shots('made', 'missed') for a sample shooter, setting as probability the shooting percentage of the real shooter1 
set.seed(572)
shot_results <- c('made', 'missed')
simul_shooter <- sample(shot_results, size = length(streak_per_player[[2]]), replace = TRUE, prob = c(shooting_percentage[[2]], 1 - shooting_percentage[[2]]))
simul_shooter


#Set 1 for baskets made and 0 for baskets missed
simul_shooter <- as.list(simul_shooter)
for(i in 1:length(simul_shooter)) {
   if(simul_shooter[i] == 'made') simul_shooter[i] <- 1
   else if(simul_shooter[i] == 'missed') simul_shooter[i] <- 0
}
simul_shooter

#Use previous function (number_of_streaks) to calculate the streaks made by the sample shooter 
streaks_of_simulshooter <- number_of_streaks(simul_shooter)

#Create new data frames for the graphs 
simulshooter_df <- data.frame('streaks' = streaks_of_simulshooter)
realshooter_df <- data.frame('streaks' = streak_per_player[[2]])

#Comparisons of data between sample shooter and real shooters
summary(simulshooter_df$streaks)
summary(realshooter_df$streaks)

#Compare barplots of sample shooter and real shooter1
#If real shooter's streaks diverge significantly from an independent shooter's streaks(sample shooter's streaks), we can conclude tha the real shooter has a 'hot hand'. 
g1 <- ggplot(data = simulshooter_df, aes(x = streaks )) + geom_bar() + labs(title = 'sample shooter')
g2 <- ggplot(data = realshooter_df, aes(x = streaks)) + geom_bar() + labs(title = 'Mo Williams')
grid.arrange(g1, g2, ncol = 2)
```

  The streak length distributions are quite similar, so we can conclude that Mo Williams doesn't have a hot hand.

###Klay Thompson
```{r}
###PLAYER 3 VS SAMPLE PLAYER###
#Simulation - create a vector of shots('made', 'missed') for a sample shooter, setting as probability the shooting percentage of the real shooter1 
set.seed(57)
shot_results <- c('made', 'missed')
simul_shooter <- sample(shot_results, size = length(streak_per_player[[3]]), replace = TRUE, prob = c(shooting_percentage[[3]], 1 - shooting_percentage[[3]]))
simul_shooter


#Set 1 for baskets made and 0 for baskets missed
simul_shooter <- as.list(simul_shooter)
for(i in 1:length(simul_shooter)) {
   if(simul_shooter[i] == 'made') simul_shooter[i] <- 1
   else if(simul_shooter[i] == 'missed') simul_shooter[i] <- 0
}
simul_shooter

#Use previous function (number_of_streaks) to calculate the streaks made by the sample shooter 
streaks_of_simulshooter <- number_of_streaks(simul_shooter)

#Create new data frames for the graphs 
simulshooter_df <- data.frame('streaks' = streaks_of_simulshooter)
realshooter_df <- data.frame('streaks' = streak_per_player[[3]])

#Comparisons of data between sample shooter and real shooters
summary(simulshooter_df$streaks)
summary(realshooter_df$streaks)

#Compare barplots of sample shooter and real shooter1
#If real shooter's streaks diverge significantly from an independent shooter's streaks(sample shooter's streaks), we can conclude tha the real shooter has a 'hot hand'. 
g1 <- ggplot(data = simulshooter_df, aes(x = streaks )) + geom_bar() + labs(title = 'sample shooter')
g2 <- ggplot(data = realshooter_df, aes(x = streaks)) + geom_bar() + labs(title = 'Klay Thompson')
grid.arrange(g1, g2, ncol = 2)
```

  Klay Thompson is an exception making 13 shots in a row. There is no such distribution in our sample, so it coulb be assumed that he is likely to have a hot hand. Further statistical analysis (logistic regression) should be done in order to reach a conclusion.


```{r}
#Regression Analysis

df1$GAME_CLOCK <-as.numeric(df1$GAME_CLOCK)

df1$AWAY_TEAM <- as.character(df1$AWAY_TEAM)

linreg_fgm <-lm(FGM ~ LOCATION+W+FINAL_MARGIN+SHOT_NUMBER+ PERIOD+GAME_CLOCK+  SHOT_CLOCK+  DRIBBLES+ TOUCH_TIME+SHOT_DIST+PTS_TYPE+ CLOSEST_DEFENDER_PLAYER_ID + CLOSE_DEF_DIST+ player_id+ WINNER, df1 )

summary(linreg_fgm)

linreg_fgm2 <-lm(FGM ~ FINAL_MARGIN+SHOT_NUMBER+ PERIOD +  SHOT_CLOCK+  DRIBBLES+ TOUCH_TIME+SHOT_DIST+PTS_TYPE+ CLOSE_DEF_DIST+ player_id, df1 )


summary(linreg_fgm2)

```


##Discussion  
###What results did you find?  

###Why is this interesting?

###What would be the next steps?

```{r}
#AR: analysis for Justin's shot acc (not to be included in the final report)

library(plyr)

ap<- read.csv("accuracy.players.csv")
head(ap)

ap$SHOT_CLOCK <- NULL

ap2 <- ddply(ap, c("player_id", "player_name","seconds.left"), summarise,
X0= sum(X0),
X1= sum(X1))

head(ap2)
ap2$acc<- ap2$X1/(ap2$X0+ap2$X1)

```



---