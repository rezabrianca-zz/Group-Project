---
title: "MSF_Groupwork-NBA_shotlog" 
author: "Team_9"
output:
  pdf_document: default
  html_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
Report produced by: Justin Leiendecker, Alexander Romanenko, Artmeis Tomadaki-Balomenou, Zijun Wei, Reza Brianca Widodo  
Date submitted: 16/10/2016

#Report structure 

##Introduction
###What is your theme or research question?
    a. Hot Hand Theory (Artemis)
    b. Defender Proximity Analysis (Reza)
    c. Shot Clock Pressure  (Alex)
    d. Close Game Effect - Small Margin affecting the scoring rate 
    e. Home Advantage (Alex is working in this point)  
    f. Fatigue Effect (Quarter Heat Rate)  
    g. Shooting Percentage (James)
    h. Fatigue Effect (Number of Rest Day)  
    i. Regression Analysis (Alex)

###Introduction/Summary

The purpose of this report is to analyse a chosen dataset and to produce meaningful results using statistical and mathematical analysis. These analyses have been conducted using RStudio software. This report will focused on analysis of a number of areas, demonstrate how the analysis has been conducted, discusses theory used, demonstrate and evaluate produced results. In addition this report will highlight potential areas of future research. 

The chosen dataset for this report is a summary of shots made during NBA season 2015-2016. The following areas of research have been selected:

#Report structure 

##Introduction
I   What is your theme or research question?
a. Hot Hand Theory (Artemis)
b. Defender Proximity Analysis (Reza)
c. Shot Clock Pressure  (Alex)
d. Close Game Effect - Small Margin affecting the scoring rate 
e. Home Advantage (Alex is working in this point)  
f. Fatigue Effect (Quarter Heat Rate)  
g. Shooting Percentage (James)
h. Fatigue Effect (Number of Rest Day)  
i. Regression Analysis (Alex)

##Theory
I   What do you expect to find?
a. 

##Methods
###Dataset Description:  
  
    Data on shots taken during the NBA 2014-2015 season for regular matches throughout the year. The data comprise of 128,609 rows and 22 columns with 16 MB data size with several value in some column is missing. The column titles are generally self-explanatory. It has the following data:   
    1.  Match ID  
    2.  Match date  
    3.  Which team plays as home and away  
    4.  Match result  
    5.  Final score difference  
    6.  Every shots attempt per game for each player  
    7.  Shot result whether it is success or not  
    8.  Type of shoot attempt (2 points or 3 points)  
    9.  Quarter number data (1 to 4)  
    10. Game clock for each quarter  
    11. Time left for a shot (shot clock)  
    12. Who took the shot  
    13. Shot distance from basket  
    14. Who was the nearest defender  
    15. Distance from the nearest defender  
  
  The dataset is useful for evaluating who the best shooter is, who the best defender is, the hot-hand hypothesis, affect of home playing team, close game effect, shooting accuracy from best players, and defender distance effect on shooting accuracy. Data was taken from NBA's REST API provided by [Kaggle](https://www.kaggle.com/dansbecker/nba-shot-logs) and acquired at 30 September 2016.  
>>>>>>> ffa732d5e8e2f51ae1f136d3572f36becfcf2f39

###Dataset Strengths  
    
    The dataset comprise of comprehensive observational data to start to work with. In general, the dataset only have small percentage of missing value (0.19%) so we do not need to remove or assign many data points to default values. And since the column name is not ambiguous it really helps us to understand dataset from the beginning. 

###Dataset Limitations  
  There are several constraints we need to mentioned in order to provide same understandings for this group work analysis as follows:  
    1. The dataset consists only for 1 year NBA season (2014-2015)  
    2. The dataset comprise only with regular match (82 matches per team for both home and away matches)  
    3. The playoff and other matches during the year is not included
    4. The dataset does not include free throw shot and results

##Analysis

### Installing libraries

```{r}
#install.packages('reshape')

```


### Calling libraries
```{r}
library(reshape)
library(ggplot2)

```


###Data clean-up 

```{r}
df<- read.csv("shot_logs.csv")  #assigning the dataframe to 'df' variables
attach(df) #telling R that this is the dataframe we'll be working with (eliminating the need to use df$ for variables)

df1<- read.csv("shot_logs1010.csv")

#we need to change the format of some of the columns to 'Character'
#get rid off 'attach()'
#get rid off column X in shot logs1010 file

```

### Home Advantage analysis

```{r}
# replacing W/L in column "W" with 1/0 (1 for win, 0 for loss)
df[,"W"] <- as.character(df[,"W"])

for (i in 1:nrow(df)) {
  if (df[i,"W"]=="W") df[i,"W"]<- 1
  if (df[i,"W"]=="L") df[i,"W"]<- 0}

df[,"W"] <- as.numeric(df[,"W"])
```

```{r}
#adding columns for names of 'home' and 'away' teams. In addition, WINNER column tells which team won
df[,"MATCHUP"] <- as.character(df[,"MATCHUP"])
df[,"W"] <- as.character(df[,"W"])

for (i in 1:nrow(df)) {
  if (LOCATION[i]=="H") {df$HOME_TEAM [i] <- unlist(strsplit(df$MATCHUP[i]," "))[5]
  df$AWAY_TEAM [i] <- unlist(strsplit(df$MATCHUP[i]," "))[7]
  if (W[i]=="W") df$WINNER[i] <- "HOME" 
  if (W[i]=="L") df$WINNER[i] <- "AWAY"}
  if (LOCATION[i]=="A") {df$HOME_TEAM [i] <- unlist(strsplit(df$MATCHUP[i]," "))[7] 
  df$AWAY_TEAM [i] <- unlist(strsplit(df$MATCHUP[i]," "))[5]
  if (W[i]=="L") df$WINNER[i] <- "HOME"  
  if (W[i]=="W") df$WINNER[i] <- "AWAY"}}

df$BLANK<-"" #for some reason cast function does not work with last column in dataframe, so I have created this BLANK column as I need to use AWAY_TEAM colum (it was a last column). 
```

```{r}
aa<- cast(df1, GAME_ID1 + HOME_TEAM + AWAY_TEAM + WINNER ~ W)

table(aa$WINNER) [2]
#home wins:
hh<-sum(aa$WINNER=="HOME")
#Away wins:
aw<-sum(aa$WINNER=="AWAY")
#percentage of home team winning: 
round(hh/(hh+aw),2)
```

```{r}
head(aa)
aa1<- cast(aa, HOME_TEAM  ~ WINNER); names(aa1)[1]<-"TEAM"
aa1$WIN_PCT_HOME<-round(aa1$HOME/(aa1$HOME+aa1$AWAY),2)

aa2<- cast(aa, AWAY_TEAM ~ WINNER); names(aa2)[1]<-"TEAM"
aa2$WIN_PCT_AWAY<-round(aa2$AWAY/(aa2$HOME+aa2$AWAY),2)

aa3<- merge (aa1,aa2, by ="TEAM")


for (i in 1:nrow(aa3)) {if(aa3$WIN_PCT_HOME[i]>aa3$WIN_PCT_AWAY[i]) aa3$HOME_ADV[i]<-"YES" else aa3$HOME_ADV[i]<-"NO"}
head(aa3)

aa3<- aa3[order(aa3$WIN_PCT_HOME,decreasing=TRUE),]
rownames(aa4)<-NULL

aa3$TEAM <- factor(aa5$TEAM, levels = aa5$TEAM[order(-aa5$WIN_PCT_HOME)])


ggplot(aa3,aes(x=TEAM)) + geom_point(aes(y= WIN_PCT_HOME, col= "HOME"))+ geom_point(aes( y= WIN_PCT_AWAY, col= "AWAY")) 
#TO BE UPDATED  
```

#Close Game Effect (Justin)

```{r}
# create new variable to seperate overtime

df[, "OVERTIME"] <- as.numeric()

for (i in 1:nrow(df)) {
  if (df[i, "PERIOD"] >= 5) df[i, "OVERTIME"] <- 1
  if (df[i, "PERIOD"] <= 4) df[i, "OVERTIME"] <- 0
}

# accuracy 
acc_ot <- as.numeric
acc_ot <- sum(df$OVERTIME == 1 & df$FGM == 1)/sum(df$OVERTIME == 1)

acc_qrt1 <- as.numeric
acc_qrt1 <- sum(df$PERIOD == 1 & df$FGM == 1)/sum(df$PERIOD == 1)

acc_qrt2 <- as.numeric
acc_qrt2 <- sum(df$PERIOD == 2 & df$FGM == 1)/sum(df$PERIOD == 2)

acc_qrt3 <- as.numeric
acc_qrt3 <- sum(df$PERIOD == 3 & df$FGM == 1)/sum(df$PERIOD == 3)

acc_qrt4 <- as.numeric
acc_qrt4 <- sum(df$PERIOD == 4 & df$FGM == 1)/sum(df$PERIOD == 4)

acc_qrt5 <- as.numeric
acc_qrt5 <- sum(df$PERIOD == 5 & df$FGM == 1)/sum(df$PERIOD == 5)

acc_qrt6 <- as.numeric
acc_qrt6 <- sum(df$PERIOD == 6 & df$FGM == 1)/sum(df$PERIOD == 6)

acc_qrt7 <- as.numeric
acc_qrt7 <- sum(df$PERIOD == 7 & df$FGM == 1)/sum(df$PERIOD == 7)

acc_qrt1_4 <- as.numeric
acc_qrt1_4 <- sum(df$PERIOD <= 4 & df$FGM == 1) / sum(df$PERIOD <= 4)

t.test(df$FGM[df$PERIOD <= 4], df$FGM[df$PERIOD >= 5])
t.test(df$FGM[df$PERIOD == 1], df$FGM[df$PERIOD == 2])
t.test(df$FGM[df$PERIOD == 2], df$FGM[df$PERIOD == 3])
t.test(df$FGM[df$PERIOD == 3], df$FGM[df$PERIOD == 4])
t.test(df$FGM[df$PERIOD == 1], df$FGM[df$PERIOD == 3])
t.test(df$FGM[df$PERIOD == 2], df$FGM[df$PERIOD == 4])


# accuracy for Top 10 scoring players




# accuracy for Shot Clock

  # dealing with missing values
df[is.na(df)] <- 99

acc <- data.frame()

#accuracy for every second
for (i in 1:23){
  acc[i, "Accuracy"] <- (sum(df$SHOT_CLOCK > i & df$SHOT_CLOCK <= i+1 & df$SHOT_CLOCK != 99 & df$FGM == 1)/ sum(df$SHOT_CLOCK > i & df$SHOT_CLOCK <= i+1 & df$SHOT_CLOCK != 99))}

acc[, "SECONDS_LEFT"] <- c(1:23)

ggplot(acc, aes(x = SECONDS_LEFT, y = Accuracy)) + geom_point() + geom_smooth()

df[, "ACC_P_SEC"] <- as.numeric()

#Assign accuracy per second to main dataframe
for (i in 1:nrow(df)){
  for (j in 1:23){
    if (df$SHOT_CLOCK[i] >j & df$SHOT_CLOCK[i] <= j+1 & df$SHOT_CLOCK[i] != 99) df[i, "ACC_P_SEC"] <- acc[j, "Accuracy"]
  }
}


cov(df$ACC_P_SEC, df$SHOT_CLOCK)
cor.test(df$ACC_P_SEC, df$SHOT_CLOCK)

```




# Shooting Percentage Analysis (James)

```{r}
# Replace "made" and "missed" with 1 and 0 respectively

df[, "SHOT_RESULT"] <- as.character(df[, "SHOT_RESULT"])
 
for (i in 1:nrow(df)) {
  if (df[i, "SHOT_RESULT"] == "made") df[i, "SHOT_RESULT"] <- 1
  if (df[i, "SHOT_RESULT"] == "missed") df[i, "SHOT_RESULT"] <- 0
}

df[, "SHOT_RESULT"] <- as.numeric(df[, "SHOT_RESULT"])

```

# Find shooting percentage of each match

```{r}
# Reshape the dataframe

game <- cast(data = df, GAME_ID1 + HOME_TEAM + AWAY_TEAM + LOCATION + player_name + W + FINAL_MARGIN~ FGM)

# Field Goal Attempts

game[, "FGA"] <- NA
for(i in 1:nrow(game)){
  game[i, "FGA"] <- game[i, "1"] + game[i, "0"]
}

# Find Feild Goal Percentage of each indivudual player in that match

game[, "FG.percentage"] <- NA 
for (i in 1:nrow(game)){
  game[i, "FG.percentage"] <- round(((game[i, "1"]/game[i, "FGA"]) * 100), digits = 2)
}
```

# Impact of Super Star Players

```{r}
# Pick out 8 of the best players in that regular season and create a new subset. Analyse how shooting percentage of these players can influence the result of a match.

super.star.list <- c("lebron james", "james harden", "russell westbrook", "stephen curry", "anthony davis", "blake griffin", "klay thompson", "lamarcus aldridge") # players picked out
super.star <- game[game$player_name %in% super.star.list, c("player_name", "W", "LOCATION", "FINAL_MARGIN", "FGA", "FG.percentage")] # create a subset for these players

# Replace "W" and "L" with 1 and 0 respectively, 
super.star[, "W"] <- as.character(super.star[, "W"])
for (i in 1:nrow(super.star)) {
  if (super.star[i, "W"] == "W") super.star[i, "W"] <- 1
  if (super.star[i, "W"] == "L") super.star[i, "W"] <- 0
}
super.star[, "W"] <- as.numeric(super.star[, "W"])

ggplot(super.star) + geom_boxplot(aes(x = player_name, y = FGA, colour = W))
ggplot(super.star) + geom_boxplot(aes(x = player_name, y = FG.percentage, colour = W))
ggplot(super.star) + geom_point(aes(x = FINAL_MARGIN, y = FGA, colour = player_name))
ggplot(super.star) + geom_boxplot(aes(x = LOCATION, y = FINAL_MARGIN))

# t.test(super.star$FINAL_MARGIN[super.star$LOCATION == "H"], super.star$FINAL_MARGIN[super.star$LOCATION == "A"])

# Correlation test
cor.test(super.star$FINAL_MARGIN, super.star$FGA)
cor.test(super.star$FINAL_MARGIN, super.star$FG.percentage) # cor = 0.272

# Linear regression
summary(lm(FINAL_MARGIN ~ FGA + LOCATION, data = super.star)) # Final margin ~ FGA and location
summary(lm(FINAL_MARGIN ~ FG.percentage + LOCATION, data = super.star)) # Final margin ~ FG% and location
summary(lm(FINAL_MARGIN ~ FG.percentage + FGA + LOCATION, data= super.star)) 

summary(lm(FINAL_MARGIN ~ LOCATION, data = super.star)) # Final margin ~ FGA and location

```


##Defender Proximity Analysis  
###Closest Defender Distance vs Shot Accuracy
####Introduction  
This analysis wants to calculate whether there was any significant effect from closest defender distance from a shooter with the shot outcome. The hypothesis is the further a defender from the shooter, then it will be more likely to increase the chance of scoring. This is because the shooter is practically in "free" condition without any physical interference.  

###Methods  
The steps to calculate this measurement are as follows:  
  1. Assign shot result to determine whether the shot is succeed (1) or missed (0)  
  2. Select distinct of **all** closest defender distance  
  3. Count the occurence fOr every distance  
  4. Calculate how many succesfull shot scored from every distance point  
  5. Calculate accuracy by dividing successfull shot scored with distance occurence for every distance point  
  6. Plot the result
```{r}
#Calculate accuracy against defender distance
#Group the defender distance level
distance_level <- as.data.frame(table(factor(ClosestDefenderDistance)))
head(distance_level)

#Calculate how many times players scored in every defender distance
for (i in 1:nrow(distance_level)){
  distance_level[i, "SCORED"] <- sum(df[df[, "CLOSE_DEF_DIST"] == distance_level[i, "Var1"], "FGM"])
}

#Calculate shooting accuracy for each distance
distance_level$Accuracy <- round(distance_level$SCORED / distance_level$Freq, 4)

#Plotting the result
library(ggplot2)
library(scales)
ggplot(data = distance_level, aes(x = distance_level$Var1, y = distance_level$Accuracy)) +
  geom_point(aes(x = distance_level$Var1, y = distance_level$Accuracy)) +
  scale_y_continuous(labels = percent, breaks = c(0, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 1.0), limits = c(0, 1)) +
  scale_x_discrete("Closest Defender Distance", breaks = c(0, 2, 4, 6, 8, 10, 12, 14, 16, 18, 20, 22, 24)) +
  ylab("Shooting Accuracy (%)") +
  ggtitle("Closest Defender Distance vs Shooting Accuracy")

```
###Plot Result
  The explanation from the plot above are as follows:   
  1. If the defender stands really close to the shooter (0 to 2 feet), the accuracy varied between **42%** to **50%**  
  2. If the defender distance range from 2 (two) to 4 (four) feet, the accuracy rate for this distance range from **44%** to **49%**  
  3. If the defender distance range from 4 (four) to 6 (six) feet, the accuracy rate for this distance range from **41%** to **46%**
  4. If the defender distance range from 6 (six) to 8 (eight) feet, the accuracy rate for this distance range from **37%** to **42%**
  5. If the defender distance range from 8 (eight) to 10 (ten) feet, the accuracy rate for this distance range from **37%** to **54%**
  6. For defender distance more than 10 feet up until 16 feet, the accuracy varies greater than previous distance range, starting from **33%** to **60%**.  
  7. For the distance greater than 16 feet, the data varies between **0%** (no shots scored from that distance) to **100%** (certain successfull shot from that distance)  

  Next analysis will be calculated from correlation test. If the analysis included **all** of the data points for every distance, the correlation result would be as follows:
```{r}
distance_level$Var1 <- as.numeric(distance_level$Var1)
distance_level$Var1 <- distance_level$Var1 * 0.1 - 0.1

distanceZerotoAll <- c()
accuracyDist1 <- c()
for (i in 0:nrow(distance_level)){
  distanceZerotoAll <- c(distanceZerotoAll, distance_level[i, "Var1"])
  accuracyDist1 <- c(accuracyDist1, distance_level[i, "Accuracy"])
}

dfZerotoAll <- data.frame(distanceZerotoAll, accuracyDist1)
cor.test(dfZerotoFive$distanceZerotoAll, dfZerotoFive$accuracyDist1)
```
###Correlation Test Result  
  The correlation test result produced slightly high number of correlation between defender distance with shooting accuracy for all shot distance attempt in the last seasons's NBA (0.59). If the findings made only based on this number only, there would be obvious that further defender distance will **automatically** increase shooting accuracy. However, after the analysis went into smaller piece of distance, ther result will be difference. For example, for distance range between 0 (zero) to 8 feet, the correlation measurement will be as follows:  
  
```{r}
distanceZerotoEight <- c()
accuracyDist2 <- c()
for (i in 0:80){
  distanceZerotoEight <- c(distanceZerotoEight, distance_level[i, "Var1"])
  accuracyDist2 <- c(accuracyDist2, distance_level[i, "Accuracy"])
}

dfZerotoEight <- data.frame(distanceZerotoEight, accuracyDist2)
cor.test(dfZerotoEight$distanceZerotoEight, dfZerotoEight$accuracyDist2)
```
  Therefore, 
  
###Discussion  
  As the analysis shown, the accuracy rate of every player in the last season was somehow **affected** by the defender distance for certain range. For defender distance starting from 0 (zero) to 8 (eight) feet For the distance greater than 16 feet, the data varies between 0% (no shots scored from that distance) to 100% (certain successfull shot from that distance). It is also shown from the dataset that only small attempt of shots were made from further defender distance affecting the accuracy calculation result. This was arguably because further defender distance did not implied shooter distance from the basket is nearer to improve the accuracy.  

###Limitations  
  As the dataset did not hold many data points for more than 20 feet defender distance, the accuracy analysis for these distances are limited. The analysis could be enhanced further by including additional season data. That way, there will be more data point for further distance and possibly would produce stronger pattern as the short distance shown.  
  
###Shooting Distance vs Shot Accuracy
####Introduction  
This analysis wants to calculate whether is there any significant effect from closest defender distance from a shooter with the shot outcome. The hypothesis is the further a defender from the shooter, then it will be more likely to increase the chance of scoring. This is because the shooter is practically in "free" condition without any physical interference.  

###Methods  
The steps to calculate this measurement are as follows:  
  1. Assign shot result to determine whether the shot is succeed (1) or missed (0)  
  2. Select distinct of **all** closest defender distance  
  3. Count the occurence fOr every distance  
  4. Calculate how many succesfull shot scored from every distance point  
  5. Calculate accuracy by dividing successfull shot scored with distance occurence for every distance point  
  6. Plot the result
```{r}
#Calculate accuracy against shooting distance
#Group the shooting distance level
shooting_distance_level <- as.data.frame(table(factor(ShotDistance)))
head(shooting_distance_level)

#Calculate how many times players scored in every shooting distance
for (i in 1:nrow(shooting_distance_level)){
  shooting_distance_level[i, "SCORED"] <- sum(df[df[, "SHOT_DIST"] == shooting_distance_level[i, "Var1"], "FGM"])
}

#Calculate shooting accuracy for each distance
shooting_distance_level$Accuracy <- round(shooting_distance_level$SCORED / shooting_distance_level$Freq, 2)

#Plotting the result
library(ggplot2)
ggplot(data = shooting_distance_level, aes(x = shooting_distance_level$Var1, y = shooting_distance_level$Accuracy)) +
  geom_point(aes(x = shooting_distance_level$Var1, y = shooting_distance_level$Accuracy))

#Data Preparation
#Change the value of shot result column to numeric
df[, "SHOT_RESULT"] <- as.character(df[, "SHOT_RESULT"])
for (j in 1:nrow(df)){
  df[j, "SHOT_RESULT"] <- ifelse (df[j, "SHOT_RESULT"] == "made", 1, 0)
}

#set the value to numeric or integer accordingly
df[, "SHOT_RESULT"] <- as.numeric(df[, "SHOT_RESULT"])
df[, "PTS_TYPE"] <- as.integer(df[, "PTS_TYPE"])
df[, "CLOSE_DEF_DIS"] <- as.numeric(df[, "CLOSE_DEF_DIST"])

#select data with only scored result
#Point type (2 or 3 points) and distance
point_type <- c()
distance <- c()
for (z in 1:nrow(df)){
  if(df[z, "SHOT_RESULT"] == 1 & df[z, "PTS_TYPE"] >= 1){
    point_type <- c(point_type, df[z, "PTS_TYPE"])
    distance <- c(distance, df[z, "CLOSE_DEF_DIST"])
  }
}

#combine point type and distance
valid_distance = data.frame(point_type, distance)

#calculate correlation between defender distance and points made (2 or 3 points)
cor(point_type, distance)

#plot the diagram for this correlation
library(ggplot2)
ggplot(data = valid_distance, aes(x = point_type, y = distance, group = point_type)) + 
  geom_boxplot() + stat_summary(fun.y = mean, geom = "point", shape = 5, size = 1) + 
  ggtitle("Points Scored based on Distance from Defender")

#calculate correlation between defender distance and shot result
cor(df[, "SHOT_RESULT"], df[, "CLOSE_DEF_DIS"])

#--------------------------------------------------------------------------------#

#Further analysis
#select distance data from 2 points shot scored and the players who scored it
distance2 <- c()
players2 <- c()
for (z in 1:nrow(df)){
  if(df[z, "SHOT_RESULT"] == 1 & df[z, "PTS_TYPE"] == 2){
    distance2 <- c(distance2, df[z, "CLOSE_DEF_DIST"])
    players2 <- c(players2, as.character(df[z, "player_name"]))
  }
}

#combine 2 point players and defender distance
player2point <- data.frame(players2, distance2)
summary(player2point)

#count players who scored 2 points
counter <- as.data.frame(table(players2))

#count 5 top players
top5Players2 <- counter[rev(order(counter$Freq)), "players2"][1:5]
top5Counter <- counter[rev(order(counter$Freq)), "Freq"][1:5]

top5_2points <- data.frame(top5players2, top5Counter)

#plot the graph
library(ggplot2)
ggplot(data = top5_2points, aes(x = top5Players2)) +
  geom_bar(aes(x = top5players2, y = top5Counter), stat = "identity")

#----------------------------------------------------------------#

#select distance data from 3 points shot scored and the players who scored it
distance3 <- c()
players3 <- c()
for (z in 1:nrow(df)){
  if(df[z, "SHOT_RESULT"] == 1 & df[z, "PTS_TYPE"] == 3){
    distance3 <- c(distance3, df[z, "CLOSE_DEF_DIST"])
    players3 <- c(players3, as.character(df[z, "player_name"]))
  }
}

#combine 3 point players and defender distance
player3point <- data.frame(players3, distance3)
summary(player3point)

#count players who scored 3 points
counter3 <- as.data.frame(table(players3))

#count 5 top players
top5Players3 <- counter3[rev(order(counter3$Freq)), "players3"][1:5]
top5Counter3 <- counter3[rev(order(counter3$Freq)), "Freq"][1:5]

top5_3points <- data.frame(top5Players3, top5Counter3)

#plot the graph
library(ggplot2)
ggplot(data = top5_3points, aes(x = top5Players3)) +
  geom_bar(aes(x = top5Players3, y = top5Counter3), stat = "identity")

```

```{r}
#Summary of total points
ptssum<- cast(df1, GAME_ID1+ player_id + player_name  ~ PTS); head(ptssum)
#creating "total points per player, per game" column
ptssum$totalpts<- ptssum[,"2"]*2 + ptssum[,"3"]*3

pttsum2<-ptssum[order(ptssum$totalpts,decreasing=TRUE),]
head(pttsum2,10)
```

```{r}
###Hot Hand Theory

#From 'FGM' column we have that 1 represents a basket made and 0 represents a basket missed
#Define the length of a shooting streak to be the number of consecutive baskets made until a miss occurs
#Create a function that gives us a vector with the number of total streaks(from all players and all games)
number_of_streaks <- function(x) {
  x <- c(0, x, 0)
  which_zero <- which(x == 0)
  streak <- diff(which_zero) - 1
  streak
}

number_of_streaks(df$FGM)

#Set a new data frame for the 5 players with best performances(higher points)
best_players_df <- head(pttsum2,5)

#Create a function that gives us a vector of streaks for a specific player and game
player_and_game <- function(x, y) {
   player <- df[df[ ,'player_id'] == x & df[ ,'GAME_ID1'] == y, 'FGM']
   number_of_streaks(as.vector(player))
}
#For the first player and game try:
#player_and_game('202681', '21400681')


#Create a list that gives us the streaks of each player and game (5 best performances)
streak_per_player <- list()
j <- 1
for(i in best_players_df$player_id) {
   streak_per_player[[j]] <- player_and_game(i, best_players_df[ourtable[ ,'player_id'] == i, 'GAME_ID1'])
   j <- j + 1
}
streak_per_player

#Remove 0 from streak_per_player in order to show only the streaks achieved
streak_per_player[[1]] <- streak_per_player[[1]][streak_per_player[[1]] != 0]
for(i in 1:length(streak_per_player)) {
  streak_per_player[[i]] <- streak_per_player[[i]][streak_per_player[[i]] != 0]
}
streak_per_player

#Create a data frame for the strikes of each one of the 10 players (cannot create a data frame including all of them, because each list has different length)
player1_df <- data.frame('streaks' = streak_per_player[[1]])
player2_df <- data.frame('streaks' = streak_per_player[[2]])
player3_df <- data.frame('streaks' = streak_per_player[[3]])
player4_df <- data.frame('streaks' = streak_per_player[[4]])
player5_df <- data.frame('streaks' = streak_per_player[[5]])

#Show distribution for each player's streak lengths
ggplot(data = player1_df, aes(x = streaks)) + geom_histogram(binwidth = 1) + labs(title = ourtable[1,'player_name'])
ggplot(data = player2_df, aes(x = streaks)) + geom_histogram(binwidth = 1) + labs(title = ourtable[2,'player_name'])
ggplot(data = player3_df, aes(x = streaks)) + geom_histogram(binwidth = 1) + labs(title = ourtable[3,'player_name'])
ggplot(data = player4_df, aes(x = streaks)) + geom_histogram(binwidth = 1) + labs(title = ourtable[4,'player_name'])
ggplot(data = player5_df, aes(x = streaks)) + geom_histogram(binwidth = 1) + labs(title = ourtable[5,'player_name'])

#Create a boxplot for each player's streak lengths
boxplot(player1_df$streaks) 
summary(player1_df$streaks) #Check that boxplot is valid
IQR(player1_df$streaks) #Check that boxplot is valid
#The typical length of a streak is 1 (median = 1) - The Interquartile Range is 1 - Streak length of 6 is unusually high compared to the rest of the distribution
boxplot(player2_df$streaks)
summary(player2_df$streaks)
IQR(player2_df$streaks)
#The typical length of a streak is 1.5 (median = 1.5) - The Interquartile Range is 1 - Streak length of 4 is unusually high compared to the rest of the distribution
boxplot(player3_df$streaks)
summary(player3_df$streaks)
IQR(player3_df$streaks)
#The typical length of a streak is 8 (median = 8) - The Interquartile Range is 5 - There is a streak lengths of 13(!!!)
boxplot(player4_df$streaks)
summary(player4_df$streaks)
IQR(player4_df$streaks)
#The typical length of a streak is 2 (median = 2) - The Interquartile Range is 1.5 - Streak length of 6 is unusually high compared to the rest of the distribution
boxplot(player5_df$streaks)
summary(player5_df$streaks)
IQR(player5_df$streaks)
#The typical length of a streak is 2 (median = 2) - The Interquartile Range is 2 - There are some high streak lengths (max = 5)

#We can see that the distribution of all players is right skewed and that all of them (especially player3) have some long shooting streaks. To prove/disprove the hot hand theory we need to examine the indipendence of the shots. If each shot that a player takes is independent of the next shot, then a missed/made shot will not affect the propability that the next shot will be missed/made. So, if consecutive shots are independent, we disprove hot hand theory, while if consecutive shots are dependent, we prove the hot hand theory.

#Find the shooting percentage for each of the 5 players
j <- 1
shooting_percentage <- list()
for(i in best_players_df$player_id) {
  shooting_percentage[j] <- sum(df[df[ ,'player_id'] == i, 'FGM'])/ nrow(df[df[ ,'player_id'] == i, ])
  j <- j+1
}
shooting_percentage

###PLAYER 1 VS SAMPLE PLAYER###
#Simulation - create a vector of shots('made', 'missed') for a sample shooter, setting as probability the shooting percentage of the real shooter1 
set.seed(21)
shot_results <- c('made', 'missed')
simul_shooter <- sample(shot_results, size = length(streak_per_player[[1]]), replace = TRUE, prob = c(shooting_percentage[[1]], 1 - shooting_percentage[[1]]))
simul_shooter


#Set 1 for baskets made and 0 for baskets missed
simul_shooter <- as.list(simul_shooter)
for(i in 1:length(simul_shooter)) {
   if(simul_shooter[i] == 'made') simul_shooter[i] <- 1
   else if(simul_shooter[i] == 'missed') simul_shooter[i] <- 0
}
simul_shooter

#Use previous function (number_of_streaks) to calculate the streaks made by the sample shooter 
streaks_of_simulshooter <- number_of_streaks(simul_shooter)

#Remove zeros
true_streaks_of_simulshooter <- list()
j <- 1
for(i in 1:length(streaks_of_simulshooter)) {
  if(streaks_of_simulshooter[[i]] != 0){
    true_streaks_of_simulshooter[j] <- streaks_of_simulshooter[[i]]
    j <- j + 1
  }
}
true_streaks_of_simulshooter
true_streaks_of_simulshooter <- unlist(true_streaks_of_simulshooter)

#Create a data frame 
simulshooter_df <- data.frame('streaks' = true_streaks_of_simulshooter)
simulshooter_df

#Comparisons of data between sample shooter and real shooters
summary(simulshooter_df$streaks)
summary(player1_df$streaks)

#Compare barplots of sample shooter and real shooter1
#If real shooter's streaks diverge significantly from an independent shooter's streaks(sample shooter's streaks), we can conclude tha the real shooter has a 'hot hand'. 
ggplot(data = simulshooter_df, aes(x = streaks)) + geom_bar() 
ggplot(data = player1_df, aes(x = streaks)) + geom_bar()
#We can see that streak length distributions are quite similar, so we can conclude that Kyrie Irving doesn't have a hot hand.

###PLAYER 2 VS SAMPLE PLAYER###
#Simulation - create a vector of shots('made', 'missed') for a sample shooter, setting as probability the shooting percentage of the real shooter2 
set.seed(154)
shot_results <- c('made', 'missed')
simul_shooter <- sample(shot_results, size = length(streak_per_player[[2]]), replace = TRUE, prob = c(shooting_percentage[[2]], 1 - shooting_percentage[[2]]))
simul_shooter


#Set 1 for baskets made and 0 for baskets missed
simul_shooter <- as.list(simul_shooter)
for(i in 1:length(simul_shooter)) {
   if(simul_shooter[i] == 'made') simul_shooter[i] <- 1
   else if(simul_shooter[i] == 'missed') simul_shooter[i] <- 0
}
simul_shooter

#Use previous function (number_of_streaks) to calculate the streaks made by the sample shooter 
streaks_of_simulshooter <- number_of_streaks(simul_shooter)

#Remove zeros
true_streaks_of_simulshooter <- list()
j <- 1
for(i in 1:length(streaks_of_simulshooter)) {
  if(streaks_of_simulshooter[[i]] != 0){
    true_streaks_of_simulshooter[j] <- streaks_of_simulshooter[[i]]
    j <- j + 1
  }
}
true_streaks_of_simulshooter
true_streaks_of_simulshooter <- unlist(true_streaks_of_simulshooter)

#Create a data frame 
simulshooter_df <- data.frame('streaks' = true_streaks_of_simulshooter)

#Comparisons of data between sample shooter and real shooters
summary(simulshooter_df$streaks)
summary(player2_df$streaks)

#Compare barplots of sample shooter and real shooter1
#If real shooter's streaks diverge significantly from an independent shooter's streaks(sample shooter's streaks), we can conclude tha the real shooter has a 'hot hand'. 
ggplot(data = simulshooter_df, aes(x = streaks)) + geom_bar() 
ggplot(data = player2_df, aes(x = streaks)) + geom_bar()
#We can see that the sample shooter with the same shooting percentage can have extremely high streak lengths, which means that Mo Williams does not have a hot hand.

###PLAYER 3###

best_players_df
#logistic regression

```

```{r}
#Regression Analysis

df1$GAME_CLOCK <-as.numeric(df1$GAME_CLOCK)

df1$AWAY_TEAM <- as.character(df1$AWAY_TEAM)

linreg_fgm <-lm(FGM ~ LOCATION+W+FINAL_MARGIN+SHOT_NUMBER+ PERIOD+GAME_CLOCK+  SHOT_CLOCK+  DRIBBLES+ TOUCH_TIME+SHOT_DIST+PTS_TYPE+ CLOSEST_DEFENDER_PLAYER_ID + CLOSE_DEF_DIST+ player_id+ WINNER, df1 )

summary(linreg_fgm)

linreg_fgm2 <-lm(FGM ~ FINAL_MARGIN+SHOT_NUMBER+ PERIOD +  SHOT_CLOCK+  DRIBBLES+ TOUCH_TIME+SHOT_DIST+PTS_TYPE+ CLOSE_DEF_DIST+ player_id, df1 )


summary(linreg_fgm2)

```


##Discussion  
###What results did you find?  

###Why is this interesting?

###What would be the next steps?
---

```{r setup, include=FALSE}

knitr::opts_chunk$set(echo = TRUE)
```
Justin Leiendecker, Alexander Romanenko, Artmeis Tomadaki-Balomenou, Zijun Wei, Reza Brianca Widodo  
 

#Report structure 

###Introduction
I   What is your theme or research question?
a. Hot Hand Theory
b. Defender Proximity Analysis
c. Shot Clock Pressure
d. Close Game Effect - Small Margin affecting the scoring rate
e. Home Advantage
f. Fatigue Effect (Quarter Heat Rate)
g. Shooting Percentage
h. Fatigue Effect (Number of Rest Day)
i. 

###Theory
I   What do you expect to find?
a. 

###Methods
I   Describe the dataset:

Data on shots taken during the 2014-2015 season, who took the shot, where on the floor was the shot taken from, who was the nearest defender, how far away was the nearest defender, time on the shot clock, and much more. The column titles are generally self-explanatory.
Useful for evaluating who the best shooter is, who the best defender is, the hot-hand hypothesis, etc.
Scraped from NBA's REST API.  ##TO BE UPDATED FURTHER

I   Strengths

I   Limitations

###Analysis

###Discussion
I   What results did you find?

I   Why is this interesting?

I   What would be the next steps?