---
title: "MSF_Groupwork-NBA_shotlog" 
author: "Team_9"
output: html_document  ---
  title: "MSF_Groupwork-NBA_shotlog"
author: "Team_9"
output: html_document 
---
  
  ```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
Justin Leiendecker, Alexander Romanenko, Artmeis Tomadaki-Balomenou, Zijun Wei, Reza Widodo  


#Report structure 

###Introduction
I   What is your theme or research question?
a. Hot Hand Theory  
b. Defender Proximity Analysis (Reza)
c. Shot Clock Pressure  
d. Close Game Effect - Small Margin affecting the scoring rate  
e. Home Advantage (Alex is working in this point)  
f. Fatigue Effect (Quarter Heat Rate)  
g. Shooting Percentage  
h. Fatigue Effect (Number of Rest Day)  
i. 

###Theory
I   What do you expect to find?
a. 

###Methods
I   Describe the dataset:
  
  Data on shots taken during the 2014-2015 season, who took the shot, where on the floor was the shot taken from, who was the nearest defender, how far away was the nearest defender, time on the shot clock, and much more. The column titles are generally self-explanatory.
Useful for evaluating who the best shooter is, who the best defender is, the hot-hand hypothesis, etc.
Scraped from NBA's REST API.  ##TO BE UPDATED FURTHER

I   Strengths

I   Limitations

###Analysis

##Installing packages
```{r}
install.packages('reshape')

```


###Data clean-up 

```{r}
df<- read.csv("shot_logs.csv")  #assigning the dataframe to 'df' variables
attach(df) #telling R that this is the dataframe we'll be working with (eliminating the need to use df$ for variables)

#we need to change the format of some of the columns to 'Character'

```
### Home Advantage analysis
```{r}
# replacing W/L in column "W" with 1/0 (1 for win, 0 for loss)
df[,"W"] <- as.character(df[,"W"])

for (i in 1:nrow(df)) {
  if (df[i,"W"]=="W") df[i,"W"]<- 1
  if (df[i,"W"]=="L") df[i,"W"]<- 0}

df[,"W"] <- as.numeric(df[,"W"])
```

```{r}
#adding columns for names of 'home' and 'away' teams
df[,"MATCHUP"] <- as.character(df[,"MATCHUP"])

for (i in 1:nrow(df)) {
  if (LOCATION[i]=="H") {df$HOME_TEAM [i] <- unlist(strsplit(df$MATCHUP[i]," "))[5]
  df$AWAY_TEAM [i] <- unlist(strsplit(df$MATCHUP[i]," "))[7]
  if (W[i]==1) df$WINNER[i] <- "HOME" 
  if (W[i]==0) df$WINNER[i] <- "AWAY"}
  if (LOCATION[i]=="A") {df$HOME_TEAM [i] <- unlist(strsplit(df$MATCHUP[i]," "))[7] 
  df$AWAY_TEAM [i] <- unlist(strsplit(df$MATCHUP[i]," "))[5]
  if (W[i]==0) df$WINNER[i] <- "HOME"  
  if (W[i]==1) df$WINNER[i] <- "AWAY"}}

df$BLANK<-"" #for some reason cast function does not work with last column in dataframe, so I have created this BLANK column as I need to use AWAY_TEAM colum (it was a last column). 
```


```{r}
#combining columns for the analysis
library(reshape)
dfwl<- cast(df, GAME_ID1 + HOME_TEAM + AWAY_TEAM + WINNER ~ LOCATION)
dfwl[,"WINNER"] <- as.character(dfwl[,"WINNER"])


for (i in 1:nrow(dfwl)) { 
if (dfwl$WINNER[i]=="HOME") dfwl$WINNER2[i]<-1
if (dfwl$WINNER[i]=="AWAY") dfwl$WINNER2[i]<-2}
```

```{r}
dfwl2<-cast(dfwl, HOME_TEAM ~ WINNER)
dfwl2<- dfwl2[,c(1,3,2)]
dfwl2$WIN_PCT<- round(dfwl2$HOME/(dfwl2$HOME+dfwl2$AWAY),2)

for (i in 1:nrow(dfwl2)) {
if(dfwl2$WIN_PCT[i]>0.5) dfwl2$HOMEADV[i]<- "YES" else dfwl2$HOMEADV[i]<- "NO"}

dfwl2<- dfwl2[order(dfwl2$WIN_PCT),]; dfwl2

library(ggplot2)
ggplot(dfwl2, aes(x=HOME_TEAM,y=WIN_PCT,col=HOMEADV))+ geom_point()
```

###Defender Proximity Analysis
```{r}
#Data Preparation
#Change the value of shot result column to numeric
df[, "SHOT_RESULT"] <- as.character(df[, "SHOT_RESULT"])
for (j in 1:nrow(df)){
  df[j, "SHOT_RESULT"] <- ifelse (df[j, "SHOT_RESULT"] == "made", 1, 0)
}

#set the value to numeric
df[, "SHOT_RESULT"] <- as.numeric(df[, "SHOT_RESULT"])
df[, "PTS_TYPE"] <- as.integer(df[, "PTS_TYPE"])
df[, "CLOSE_DEF_DIS"] <- as.numeric(df[, "CLOSE_DEF_DIST"])

#calculate correlation between defender distance and shot result
cor(df[, "SHOT_RESULT"], df[, "CLOSE_DEF_DIS"])

#calculate correlation between defender distance and points made (2 or 3 points)
cor(df[, "PTS_TYPE"], df[, "CLOSE_DEF_DIS"])

#plot the diagram
library(ggplot2)
ggplot(data = df, aes(x = PTS_TYPE, y = CLOSE_DEF_DIST, group = PTS_TYPE)) + geom_boxplot() + stat_summary(fun.y = mean, geom = "point", shape = 5, size = 1) +ggtitle("Points Scored based on Distance from Defender")
```


###Discussion
I   What results did you find?

I   Why is this interesting?

I   What would be the next steps?
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
Justin Leiendecker, Alexander Romanenko, Artmeis Tomadaki-Balomenou, Zijun Wei, Reza Widodo  
 

#Report structure 

###Introduction
I   What is your theme or research question?
a. Hot Hand Theory
b. Defender Proximity Analysis
c. Shot Clock Pressure
d. Close Game Effect - Small Margin affecting the scoring rate
e. Home Advantage
f. Fatigue Effect (Quarter Heat Rate)
g. Shooting Percentage
h. Fatigue Effect (Number of Rest Day)
i. 

###Theory
I   What do you expect to find?
a. 

###Methods
I   Describe the dataset:

Data on shots taken during the 2014-2015 season, who took the shot, where on the floor was the shot taken from, who was the nearest defender, how far away was the nearest defender, time on the shot clock, and much more. The column titles are generally self-explanatory.
Useful for evaluating who the best shooter is, who the best defender is, the hot-hand hypothesis, etc.
Scraped from NBA's REST API.  ##TO BE UPDATED FURTHER

I   Strengths

I   Limitations

###Analysis

###Discussion
I   What results did you find?

I   Why is this interesting?

I   What would be the next steps?